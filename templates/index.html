<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VORTEX ‚Äî –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —á–∞—Ç</title>
    <link rel="stylesheet" href="/static/css/main.css">
</head>
<body>

<!-- ‚îÄ‚îÄ AUTH SCREEN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div id="auth-screen" class="screen active" style="display:flex;">
    <div class="auth-card">
        <div class="auth-logo">
            <div class="big-icon">‚ö°</div>
            <h1>VORTEX</h1>
            <p>// –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —á–∞—Ç –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞</p>
        </div>
        <div class="auth-tabs">
            <button class="auth-tab active" onclick="switchTab('login')">–í–æ–π—Ç–∏</button>
            <button class="auth-tab" onclick="switchTab('register')">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
        </div>

        <div id="auth-alert" class="alert"></div>

        <!-- LOGIN -->
        <div id="login-form">
            <div class="form-group">
                <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω –∏–ª–∏ –∏–º—è</label>
                <input class="form-input" id="l-login" type="text" placeholder="+79001234567 –∏–ª–∏ username" autocomplete="off">
            </div>
            <div class="form-group">
                <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                <input class="form-input" id="l-pass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>
            <button class="btn btn-primary" onclick="doLogin()">‚ö° –í–æ–π—Ç–∏</button>
        </div>

        <!-- REGISTER -->
        <div id="register-form" style="display:none;">
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                    <input class="form-input" id="r-phone" type="tel" placeholder="+79001234567">
                </div>
                <div class="form-group">
                    <label class="form-label">–ù–∏–∫–Ω–µ–π–º</label>
                    <input class="form-input" id="r-username" type="text" placeholder="username">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">–ò–º—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</label>
                <input class="form-input" id="r-display" type="text" placeholder="–ö–∞–∫ –≤–∞—Å –Ω–∞–∑—ã–≤–∞—Ç—å?">
            </div>
            <div class="form-group">
                <label class="form-label">–ü–∞—Ä–æ–ª—å (–º–∏–Ω. 8 —Å–∏–º–≤–æ–ª–æ–≤)</label>
                <input class="form-input" id="r-pass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>
            <div class="form-group">
                <label class="form-label">–ê–≤–∞—Ç–∞—Ä</label>
                <div class="emoji-grid" id="emoji-picker">
                    <button class="emoji-btn emoji-selected" data-emoji="üë§" onclick="selectEmoji(this)">üë§</button>
                    <button class="emoji-btn" data-emoji="ü¶ä" onclick="selectEmoji(this)">ü¶ä</button>
                    <button class="emoji-btn" data-emoji="üê∫" onclick="selectEmoji(this)">üê∫</button>
                    <button class="emoji-btn" data-emoji="ü¶Å" onclick="selectEmoji(this)">ü¶Å</button>
                    <button class="emoji-btn" data-emoji="üêâ" onclick="selectEmoji(this)">üêâ</button>
                    <button class="emoji-btn" data-emoji="ü¶Ö" onclick="selectEmoji(this)">ü¶Ö</button>
                    <button class="emoji-btn" data-emoji="üåô" onclick="selectEmoji(this)">üåô</button>
                    <button class="emoji-btn" data-emoji="‚ö°" onclick="selectEmoji(this)">‚ö°</button>
                    <button class="emoji-btn" data-emoji="üîÆ" onclick="selectEmoji(this)">üîÆ</button>
                    <button class="emoji-btn" data-emoji="üõ∏" onclick="selectEmoji(this)">üõ∏</button>
                    <button class="emoji-btn" data-emoji="üíÄ" onclick="selectEmoji(this)">üíÄ</button>
                    <button class="emoji-btn" data-emoji="üåä" onclick="selectEmoji(this)">üåä</button>
                    <button class="emoji-btn" data-emoji="üî•" onclick="selectEmoji(this)">üî•</button>
                    <button class="emoji-btn" data-emoji="‚ùÑÔ∏è" onclick="selectEmoji(this)">‚ùÑÔ∏è</button>
                    <button class="emoji-btn" data-emoji="üé≠" onclick="selectEmoji(this)">üé≠</button>
                    <button class="emoji-btn" data-emoji="üöÄ" onclick="selectEmoji(this)">üöÄ</button>
                </div>
            </div>
            <button class="btn btn-primary" onclick="doRegister()">‚ú¶ –°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
        </div>
    </div>
</div>

<!-- ‚îÄ‚îÄ MAIN APP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div id="app" style="display:none;">
    <!-- Sidebar -->
    <div id="sidebar">
        <div class="sidebar-header">
            <div class="logo"><div class="logo-icon">‚ö°</div>VORTEX</div>
            <div class="user-badge" onclick="showProfileModal()">
                <div class="avatar" id="sb-avatar">üë§</div>
                <div class="user-info">
                    <div class="user-name" id="sb-name">‚Äî</div>
                    <div class="user-phone" id="sb-phone">‚Äî</div>
                </div>
                <span style="color:var(--text3);font-size:12px;">‚öô</span>
            </div>
        </div>

        <div class="net-status">
            <div class="net-dot online" id="net-dot"></div>
            <span id="net-label">0 —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –≤ —Å–µ—Ç–∏</span>
        </div>

        <div class="nav-section">
            <div class="nav-label">–ú–µ–Ω—é</div>
            <div class="nav-item active" onclick="showWelcome()" id="nav-welcome">
                <span class="icon">üè†</span> –ì–ª–∞–≤–Ω–∞—è
            </div>
            <div class="nav-item" onclick="showCreateRoomModal()">
                <span class="icon">Ôºã</span> –ù–æ–≤–∞—è –∫–æ–º–Ω–∞—Ç–∞
            </div>
            <div class="nav-item" onclick="showJoinModal()">
                <span class="icon">üîó</span> –í—Å—Ç—É–ø–∏—Ç—å –ø–æ –∫–æ–¥—É
            </div>
            <div class="nav-item" onclick="togglePeersPanel()">
                <span class="icon">üì°</span> –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤ —Å–µ—Ç–∏
                <span class="badge" id="peers-badge">0</span>
            </div>
        </div>

        <div class="nav-section">
            <div class="nav-label">–ú–æ–∏ –∫–æ–º–Ω–∞—Ç—ã</div>
        </div>
        <div class="rooms-list" id="rooms-list"></div>

        <div class="sidebar-footer">
            <button class="footer-btn" onclick="loadPublicRooms()">üåê –ü—É–±–ª–∏—á–Ω—ã–µ</button>
            <button class="footer-btn danger" onclick="doLogout()">‚Üê –í—ã–π—Ç–∏</button>
        </div>
    </div>

    <!-- Main content -->
    <div id="main">
        <!-- Welcome -->
        <div id="welcome-screen" class="screen active">
            <div class="welcome-icon">‚ö°</div>
            <div class="welcome-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å</div>
            <div class="welcome-sub">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–Ω–∞—Ç—É –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é. –°–≤—è–∑—å —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ ‚Äî —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–∞—è —Å–µ—Ç—å.</div>
            <div style="display:flex;gap:10px;margin-top:8px;">
                <button class="btn btn-primary btn-sm" onclick="showCreateRoomModal()">+ –°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É</button>
                <button class="btn btn-secondary btn-sm" onclick="showJoinModal()">üîó –í—Å—Ç—É–ø–∏—Ç—å –ø–æ –∫–æ–¥—É</button>
            </div>
        </div>

        <!-- Chat -->
        <div id="chat-screen" class="screen">
            <div id="chat-header">
                <div style="flex:1;min-width:0;">
                    <div class="chat-title" id="chat-room-name">‚Äî</div>
                    <div class="chat-meta" id="chat-room-meta">‚Äî</div>
                </div>
                <button class="header-btn" onclick="showMembersModal()" title="–£—á–∞—Å—Ç–Ω–∏–∫–∏">üë•</button>
                <button class="header-btn" onclick="startVoiceCall()" title="–ì–æ–ª–æ—Å–æ–≤–æ–π –∑–≤–æ–Ω–æ–∫" id="call-btn">üìû</button>
                <button class="header-btn" onclick="showRoomFilesModal()" title="–§–∞–π–ª—ã">üìÅ</button>
                <button class="header-btn" onclick="togglePeersPanel()" title="–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞">üì°</button>
                <button class="header-btn" onclick="copyInviteCode()" title="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥">üîó</button>
            </div>

            <div id="messages-container"></div>

            <div class="typing-indicator" id="typing-indicator">
                <div class="typing-dots">
                    <span></span><span></span><span></span>
                </div>
                <span id="typing-text">–∫—Ç–æ-—Ç–æ –ø–µ—á–∞—Ç–∞–µ—Ç</span>
            </div>

            <div id="input-area">
                <div class="input-row">
                    <button class="input-btn" onclick="triggerFileUpload()" title="–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª">üìé</button>
                    <textarea id="msg-input" rows="1" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..."
                              onkeydown="handleKey(event)" oninput="handleTyping()"></textarea>
                    <button class="input-btn send" onclick="sendMessage()" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å">‚Üë</button>
                </div>
                <input type="file" id="file-input" style="display:none" onchange="uploadFile(event)">
            </div>
        </div>
    </div>

    <!-- Peers panel -->
    <div id="peers-panel">
        <div class="panel-header">
            üì° –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤ —Å–µ—Ç–∏
            <span class="panel-close" onclick="togglePeersPanel()">√ó</span>
        </div>
        <div id="peers-list" style="overflow-y:auto;flex:1;"></div>
    </div>
</div>

<!-- ‚îÄ‚îÄ MODALS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->

<!-- Create Room -->
<div class="modal-overlay" id="create-room-modal">
    <div class="modal">
        <div class="modal-title">üè† –ù–æ–≤–∞—è –∫–æ–º–Ω–∞—Ç–∞</div>
        <div id="cr-alert" class="alert"></div>
        <div class="form-group">
            <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
            <input class="form-input" id="cr-name" placeholder="–ú–æ—è –∫–æ–º–Ω–∞—Ç–∞">
        </div>
        <div class="form-group">
            <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
            <input class="form-input" id="cr-desc" placeholder="–û —á—ë–º —ç—Ç–∞ –∫–æ–º–Ω–∞—Ç–∞?">
        </div>
        <div class="form-group" style="display:flex;align-items:center;gap:10px;">
            <input type="checkbox" id="cr-private" style="width:18px;height:18px;accent-color:var(--accent);">
            <label for="cr-private" style="font-size:13px;cursor:pointer;">–ü—Ä–∏–≤–∞—Ç–Ω–∞—è (—Ç–æ–ª—å–∫–æ –ø–æ –∫–æ–¥—É)</label>
        </div>
        <div class="modal-actions">
            <button class="btn btn-secondary" onclick="closeModal('create-room-modal')">–û—Ç–º–µ–Ω–∞</button>
            <button class="btn btn-primary" onclick="createRoom()">‚ú¶ –°–æ–∑–¥–∞—Ç—å</button>
        </div>
    </div>
</div>

<!-- Join Room -->
<div class="modal-overlay" id="join-modal">
    <div class="modal">
        <div class="modal-title">üîó –í—Å—Ç—É–ø–∏—Ç—å –ø–æ –∫–æ–¥—É</div>
        <div id="join-alert" class="alert"></div>
        <div class="form-group">
            <label class="form-label">Invite-–∫–æ–¥ (8 —Å–∏–º–≤–æ–ª–æ–≤)</label>
            <input class="form-input" id="join-code" placeholder="ABCD1234"
                   style="text-transform:uppercase;letter-spacing:3px;font-size:18px;text-align:center;"
                   maxlength="8" oninput="this.value=this.value.toUpperCase()">
        </div>
        <div class="modal-actions">
            <button class="btn btn-secondary" onclick="closeModal('join-modal')">–û—Ç–º–µ–Ω–∞</button>
            <button class="btn btn-primary" onclick="joinRoom()">‚Üí –í—Å—Ç—É–ø–∏—Ç—å</button>
        </div>
    </div>
</div>

<!-- Members -->
<div class="modal-overlay" id="members-modal">
    <div class="modal">
        <div class="modal-title">üë• –£—á–∞—Å—Ç–Ω–∏–∫–∏</div>
        <div id="members-list" style="max-height:300px;overflow-y:auto;"></div>
        <div style="margin-top:16px;padding:12px;background:var(--bg3);border-radius:var(--radius);font-family:var(--mono);font-size:12px;">
            <div style="color:var(--text2);margin-bottom:4px;">Invite-–∫–æ–¥ –∫–æ–º–Ω–∞—Ç—ã:</div>
            <div style="display:flex;align-items:center;gap:8px;">
                <span id="modal-invite-code" style="font-size:16px;letter-spacing:3px;font-weight:700;color:var(--accent2);">‚Äî</span>
                <button class="btn btn-secondary btn-sm" onclick="copyInviteCode()">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
        </div>
        <div class="modal-actions">
            <button class="btn btn-secondary" onclick="closeModal('members-modal')">–ó–∞–∫—Ä—ã—Ç—å</button>
            <button class="btn btn-danger" onclick="leaveRoom()">‚Üê –í—ã–π—Ç–∏ –∏–∑ –∫–æ–º–Ω–∞—Ç—ã</button>
        </div>
    </div>
</div>

<!-- Public Rooms -->
<div class="modal-overlay" id="public-modal">
    <div class="modal" style="width:480px;">
        <div class="modal-title">üåê –ü—É–±–ª–∏—á–Ω—ã–µ –∫–æ–º–Ω–∞—Ç—ã</div>
        <div id="public-list" style="max-height:350px;overflow-y:auto;"></div>
        <div class="modal-actions">
            <button class="btn btn-secondary" onclick="closeModal('public-modal')">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>
</div>

<!-- Files -->
<div class="modal-overlay" id="files-modal">
    <div class="modal" style="width:460px;">
        <div class="modal-title">üìÅ –§–∞–π–ª—ã –∫–æ–º–Ω–∞—Ç—ã</div>
        <div id="files-list" style="max-height:320px;overflow-y:auto;"></div>
        <div class="modal-actions">
            <button class="btn btn-secondary" onclick="closeModal('files-modal')">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>
</div>

<!-- Profile -->
<div class="modal-overlay" id="profile-modal">
    <div class="modal">
        <div class="modal-title">‚öô –ü—Ä–æ—Ñ–∏–ª—å</div>
        <div style="background:var(--bg3);border-radius:var(--radius);padding:14px;margin-bottom:16px;">
            <div style="font-size:12px;color:var(--text2);font-family:var(--mono);margin-bottom:4px;">–¢–µ–ª–µ—Ñ–æ–Ω</div>
            <div style="font-weight:700;font-family:var(--mono);" id="prof-phone">‚Äî</div>
            <div style="font-size:12px;color:var(--text2);font-family:var(--mono);margin-top:8px;margin-bottom:4px;">Username</div>
            <div style="font-weight:700;" id="prof-username">‚Äî</div>
            <div style="font-size:12px;color:var(--text2);font-family:var(--mono);margin-top:8px;margin-bottom:4px;">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω</div>
            <div style="font-family:var(--mono);font-size:12px;" id="prof-created">‚Äî</div>
        </div>
        <div class="modal-actions">
            <button class="btn btn-secondary" onclick="closeModal('profile-modal')">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>
</div>

<!-- ‚îÄ‚îÄ CALL OVERLAY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div id="call-overlay">
    <video id="remote-video" autoplay playsinline></video>
    <video id="local-video"  autoplay playsinline muted></video>

    <div class="call-avatar" id="call-peer-avatar">üë§</div>
    <div class="call-name"   id="call-peer-name">‚Äî</div>
    <div class="call-status" id="call-status">–í—ã–∑–æ–≤...</div>

    <div class="call-controls">
        <button class="call-btn mute" id="mute-btn" onclick="toggleMute()">üé§</button>
        <button class="call-btn mute" id="cam-btn"  onclick="toggleCam()">üì∑</button>
        <button class="call-btn hangup" onclick="hangup()">üìµ</button>
    </div>
</div>

<!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ JavaScript –º–æ–¥—É–ª–µ–π (ES –º–æ–¥—É–ª–∏) -->
<script type="module" src="/static/js/utils.js"></script>
<script type="module" src="/static/js/auth.js"></script>
<script type="module" src="/static/js/rooms.js"></script>
<script type="module" src="/static/js/chat.js"></script>
<script type="module" src="/static/js/peers.js"></script>
<script type="module" src="/static/js/webrtc.js"></script>
<script type="module" src="/static/js/ui.js"></script>
<script type="module" src="/static/js/main.js"></script>
</body>
</html>